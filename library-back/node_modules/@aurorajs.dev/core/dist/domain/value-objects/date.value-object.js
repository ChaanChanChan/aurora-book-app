"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DateValueObject = void 0;
const common_1 = require("@nestjs/common");
const string_value_object_1 = require("./string.value-object");
const utils_1 = require("../shared/utils");
const utc = require("dayjs/plugin/utc");
const timezone = require("dayjs/plugin/timezone");
const dayjs = require("dayjs");
dayjs.extend(utc);
dayjs.extend(timezone);
class DateValueObject extends string_value_object_1.StringValueObject {
    set value(value) {
        if ((value === undefined || value === null) && this.data.currentDate)
            value = utils_1.Utils.nowDate();
        super.value = value;
        if (value === null || value === undefined)
            return;
        if (value !== null && value !== undefined && !((new Date(value)).getTime() > 0))
            throw new common_1.BadRequestException(`Value for ${this.validationRules.name} has to be a date value, value ${value} is a not valid date, format YYYY-MM-DD expected`);
        if (this.data.addTimezone) {
            super.value = dayjs.tz(value, process.env.TZ).tz(this.data.addTimezone).format('YYYY-MM-DD');
        }
        else if (this.data.removeTimezone) {
            super.value = dayjs.tz(value, this.data.removeTimezone).tz(process.env.TZ).format('YYYY-MM-DD');
        }
        else {
            super.value = dayjs(value, 'YYYY-MM-DD').format('YYYY-MM-DD');
        }
    }
    get value() {
        return super.value;
    }
}
exports.DateValueObject = DateValueObject;
